<%- include('../partials/headers', { title: "Manage Class Types" }) %>
<%- include('../partials/sidebar', { title: "Class Types" }) %>

<div class="content-wrapper">
  <!-- Page Header -->
  <section class="content-header">
    <div class="container-fluid">
      <div class="row mb-2 align-items-center">
        <div class="col-sm-6">
          <h1 class="m-0">Manage Class Types</h1>
        </div>
        <div class="col-sm-6 text-end">
          <a href="/admin/class-type/add" class="btn btn-primary btn-sm">
            <i class="bi bi-plus-circle"></i> Add Class Type
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- ✅ Success Message -->
  <% if (success) { %>
    <div class="alert alert-success text-center mx-3">
      <%= success %>
    </div>
  <% } %>

  <!-- ✅ Error Messages -->
  <% if (errors && errors.length > 0) { %>
    <div class="alert alert-danger mx-3">
      <ul class="mb-0">
        <% errors.forEach(err => { %>
          <li><%= err %></li>
        <% }); %>
      </ul>
    </div>
  <% } %>

  <!-- ✅ Main Table -->
  <section class="content">
    <div class="container-fluid">
      <div class="card card-outline card-primary shadow-sm">
        <div class="card-header">
          <h3 class="card-title">Class Type List</h3>
        </div>
        <div class="card-body table-responsive">
          <table class="table table-bordered table-striped table-hover align-middle">
            <thead class="table-primary text-center">
              <tr>
                <th>#</th>
                <th>Image</th>
                <th>Name</th>
                <th>Description</th>
                <th>Duration (min)</th>
                <th>Status</th>
                <th style="width: 200px;">Actions</th>
              </tr>
            </thead>
            <tbody>
              <% if (classTypes && classTypes.length > 0) { %>
                <% classTypes.forEach((ct, index) => { %>
                  <tr>
                    <td class="text-center"><%= index + 1 %></td>

                    <!-- ✅ Image -->
                    <td class="text-center">
                      <% if (ct.image) { %>
                        <img src="<%= ct.image %>" alt="Class Type" class="rounded-circle border" width="60" height="60">
                      <% } else { %>
                        <img src="/images/default-avatar.png" alt="Default" class="rounded-circle border" width="60" height="60">
                      <% } %>
                    </td>

                    <!-- ✅ Name / Description -->
                    <td><%= ct.name %></td>
                    <td><%= ct.description || '-' %></td>
                    <td class="text-center"><%= ct.duration_minutes %></td>

                    <!-- ✅ Status -->
                    <td class="text-center">
                      <% if (ct.is_active) { %>
                        <span class="badge bg-success">Active</span>
                      <% } else { %>
                        <span class="badge bg-secondary">Inactive</span>
                      <% } %>
                    </td>

                    <!-- ✅ Actions -->
                    <td class="text-center">
                      <a href="/admin/class-type/<%= ct.id %>" class="btn btn-info btn-sm me-1">
                        <i class="bi bi-eye"></i> Show
                      </a>
                      <a href="/admin/class-type/edit/<%= ct.id %>" class="btn btn-warning btn-sm me-1">
                        <i class="bi bi-pencil-square"></i> Edit
                      </a>
                      <button class="btn btn-danger btn-sm delete-btn" data-id="<%= ct.id %>">
                        <i class="bi bi-trash"></i> Delete
                      </button>
                    </td>
                  </tr>
                <% }); %>
              <% } else { %>
                <tr>
                  <td colspan="7" class="text-center text-muted py-4">
                    No class types found.
                  </td>
                </tr>
              <% } %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </section>
</div>

<!-- ✅ SweetAlert for Delete Confirmation -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.delete-btn').forEach(button => {
      button.addEventListener('click', async () => {
        const id = button.dataset.id;

        Swal.fire({
          title: 'Are you sure?',
          text: "You won't be able to revert this!",
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#3085d6',
          cancelButtonColor: '#d33',
          confirmButtonText: 'Yes, delete it!'
        }).then(result => {
          if (result.isConfirmed) {
            fetch(`/admin/class-type/delete/${id}`, { method: 'DELETE' })
              .then(res => res.json())
              .then(data => {
                if (data.success) {
                  Swal.fire('Deleted!', data.message, 'success');
                  setTimeout(() => window.location.reload(), 1000);
                } else {
                  Swal.fire('Error', data.message, 'error');
                }
              })
              .catch(() => Swal.fire('Error', 'Something went wrong', 'error'));
          }
        });
      });
    });
  });
</script>

<%- include('../partials/footer') %>
