<%- include('../partials/headers', { title: "Manage Videos" }) %>
<%- include('../partials/sidebar', { title: "Videos" }) %>

<div class="content-wrapper">
  <section class="content-header">
    <div class="container-fluid d-flex justify-content-between align-items-center">
      <h1>Videos</h1>
      <a href="/admin/videos/add" class="btn btn-primary btn-sm"><i class="bi bi-plus-circle"></i> Add Video</a>
    </div>
  </section>

  <% if (success) { %>
    <div class="alert alert-success text-center mx-3"><%= success %></div>
  <% } %>
  <% if (errors && errors.length) { %>
    <div class="alert alert-danger mx-3">
      <ul><% errors.forEach(e => { %><li><%= e %></li><% }); %></ul>
    </div>
  <% } %>

  <section class="content">
    <div class="container-fluid">
      <div class="card card-outline card-primary shadow-sm">
        <div class="card-body table-responsive">
          <table class="table table-bordered table-hover text-center">
            <thead class="table-primary">
              <tr>
                <th>#</th>
                <th>Thumbnail</th>
                <th>Title</th>
                <th>Instructor</th>
                <th>Class Type</th>
                <th>Duration</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <% if (videos.length > 0) { %>
                <% videos.forEach((v, i) => { %>
                  <tr>
                    <td><%= i + 1 %></td>
                    <td><img src="<%= v.thumbnail %>" width="80" class="rounded shadow-sm"></td>
                    <td><%= v.title %></td>
                    <td><%= v.instructor.first_name %> <%= v.instructor.last_name %></td>
                    <td><%= v.classType.name %></td>
                    <td><%= v.duration || '-' %> mins</td>
                    <td>
                      <a href="/admin/videos/<%= v.id %>" class="btn btn-info btn-sm me-1">View</a>
                      <a href="/admin/videos/edit/<%= v.id %>" class="btn btn-warning btn-sm me-1">Edit</a>
                      <button data-id="<%= v.id %>" class="btn btn-danger btn-sm delete-btn">Delete</button>
                    </td>
                  </tr>
                <% }) %>
              <% } else { %>
                <tr><td colspan="7" class="text-muted">No videos found.</td></tr>
              <% } %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </section>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
  document.querySelectorAll('.delete-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const id = btn.dataset.id;
      Swal.fire({
        title: 'Are you sure?',
        text: "Delete this video?",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Yes, delete it!'
      }).then(result => {
        if (result.isConfirmed) {
          fetch(`/admin/videos/delete/${id}`, { method: 'DELETE' })
            .then(res => res.json())
            .then(data => {
              if (data.success) {
                Swal.fire('Deleted!', data.message, 'success');
                setTimeout(() => location.reload(), 1000);
              } else {
                Swal.fire('Error', data.message, 'error');
              }
            });
        }
      });
    });
  });
</script>

<%- include('../partials/footer') %>
